---
title: "synoptic_workspace"
author: "Zack Grzywacz"
date: "March 2, 2021"
output: html_document
---

```{r}
library(dplyr)
```


```{r}
daily <- read.delim("./data/SOM_daily_z500_anomaly_3_3.txt", sep = " ")
```


Here:
Basically creating the same dataset Udy did, where each season has detailed counts.

Also: treat it as a time series w/monthly percentages

```{r}
daily$year <- substr(daily$date, 1, 4)
daily$month <- substr(daily$date, 5,6)
daily$year <- as.numeric(daily$year)
daily$month <- as.numeric(daily$month)
```


```{r}
daily$season <- NA
for (x in 1:nrow(daily))
{
  if (daily$month[x] == 12 | daily$month[x] == 1 | daily$month[x] == 2){
    daily$season[x] <- 'DJF'
  }
  else if (daily$month[x] == 3 | daily$month[x] == 4 | daily$month[x] == 5){
    daily$season[x] <- 'MAM'
  }
  else if (daily$month[x] == 6 | daily$month[x] == 7 | daily$month[x] == 8){
    daily$season[x] <- 'JJA'
  }
  else if (daily$month[x] == 9 | daily$month[x] == 10 | daily$month[x] == 11){
    daily$season[x] <- 'SON'
  }
}
```


*Note: June - May might be the "year" to look at (number assigned being June - Dec year)
```{r}
daily$seas_yr <- 0
for (x in 1:nrow(daily))
{
  if (daily[x,4] == 1 | daily[x,4] == 2 | daily[x,4] == 3 | daily[x,4] == 4 | daily[x,4] == 5)
  {
    daily$seas_yr[x] <- (daily$year[x]-1)
  }
  else
  {
    daily$seas_yr[x] <- daily$year[x]
  }
}
```

```{r}
DJF_daily <- subset(daily, season == 'DJF')
MAM_daily <- subset(daily, season == 'MAM')
JJA_daily <- subset(daily, season == 'JJA')
SON_daily <- subset(daily, season == 'SON')
```


```{r}
daily_summary <- daily %>% group_by(seas_yr, season, node) %>% summarise(n=n())
daily_summary_yrs <- daily %>% group_by(seas_yr, node) %>% summarise(n=n())
```

```{r}
split_years <- split(daily_summary_yrs, daily_summary_yrs$seas_yr)
```

```{r}
split_years[["1979"]] %>% group_by(node) %>% summarise(percent = n/sum(split_years[["1979"]]$n)*100)
```

```{r}
yr_range <- c(1979:2017)
nodes <- 1:9
summarized <- data.frame("SOM1"=double(),"SOM2"=double(),"SOM3"=double(),"SOM4"=double(),"SOM5"=double(),"SOM6"=double(),"SOM7"=double(),"SOM8"=double(),"SOM9"=double())
for (year in 1979:2017)
{
  yr <- toString(year)
  datapoint <- data.frame(t(split_years[[yr]] %>% group_by(node) %>% summarise(percent = n/sum(split_years[[yr]]$n)*100)))
  rownames(datapoint) <- NULL
  names(datapoint) <- names(summarized)
  summarized <- rbind(summarized,datapoint[2,])
}
row.names(summarized) <- yr_range
annual_summary <- summarized
```



```{r}
summarize_SOM_data <- function(daily){
daily_summary <- daily %>% group_by(seas_yr, season, node) %>% summarise(n=n())
daily_summary_yrs <- daily %>% group_by(seas_yr, node) %>% summarise(n=n())
split_years <- split(daily_summary_yrs, daily_summary_yrs$seas_yr)
yr_range <- c(1979:2017)
nodes <- 1:9
summarized <- data.frame("SOM1"=double(),"SOM2"=double(),"SOM3"=double(),"SOM4"=double(),"SOM5"=double(),"SOM6"=double(),"SOM7"=double(),"SOM8"=double(),"SOM9"=double())
for (year in 1979:2017)
{
  yr <- toString(year)
  for (num in 1:9){
    if (num %in% split_years[[yr]]$node == 'FALSE'){
      newrow <- c(year,num,0)  
      names(newrow) <- c("seas_yr","node","n")
      split_years[[yr]] <- rbind(split_years[[yr]], newrow)
    }
  }
  datapoint <- data.frame(t(split_years[[yr]] %>% group_by(node) %>% summarise(percent = n/sum(split_years[[yr]]$n)*100)))
  rownames(datapoint) <- NULL
  names(datapoint) <- names(summarized)
  summarized <- rbind(summarized,datapoint[2,])
}
row.names(summarized) <- yr_range
return(summarized)
}
```

```{r}
JJA_summary <- summarize_SOM_data(JJA_daily)
SON_summary <- summarize_SOM_data(SON_daily)
DJF_summary <- summarize_SOM_data(DJF_daily)
MAM_summary <- summarize_SOM_data(MAM_daily)
```



